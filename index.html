import React, { useState } from 'react';
import { Heart, Stars, Lock, Smartphone, Camera, Check } from 'lucide-react';

export default function App() {
  const [stage, setStage] = useState('landing'); // 'landing' | 'asking' | 'forgiven'
  const [noCount, setNoCount] = useState(0);
  const [noStyle, setNoStyle] = useState({}); 
  const [yesSizeMultiplier, setYesSizeMultiplier] = useState(1);
  const [isSending, setIsSending] = useState(false);
  const [photoSent, setPhotoSent] = useState(false);
  
  const TAP_LIMIT = 20;

  // Your Web3Forms Access Key
  const ACCESS_KEY = "b8b3db7b-68d5-4873-bcf3-3bf480902c65";

  const phrases = [
    "Nhi karna ja üò§",
    "Plzz maff kar do ü•∫ü•∫",
    "Kardo naaa üò©üò©",
    "Accha nhi sounga yarr üôÉüôÉ",
    "Dil tod diya üíî",
    "Ab toh maan jao üò≠",
    "Kitna bhav khaogi? üòí",
    "Sorry bola na baba üòì",
    "Pleaseeeee ü•∫",
    "Maan jao na cutie ü•∞",
    "Bhuk lagi hai yaar maan jao ü•ò",
    "Ro dunga main ab üò≠",
    "Pakka last mistake! ü§û",
    "Bas kardo ab ü§ï",
    "My fingers hurt coding this ‚å®Ô∏è",
    "Forgive meeeee üê¢",
    "Last chance to be nice!",
    "Okay I give up...",
    "Just kidding, please!",
    "ALMOST THERE..."
  ];

  const moveButton = (e) => {
    // Stop ghost clicks
    if (e && e.type === 'touchstart') {
      e.preventDefault();
    }

    if (noCount >= TAP_LIMIT) return;

    const zone = Math.floor(Math.random() * 8);
    let newStyle = { position: 'fixed', zIndex: 50, transition: 'all 0.2s ease' };
    const M = '20px';

    switch(zone) {
      case 0: newStyle.top = M; newStyle.left = M; break; // Top-Left
      case 1: newStyle.top = M; newStyle.left = '50%'; newStyle.transform = 'translateX(-50%)'; break; // Top-Center
      case 2: newStyle.top = M; newStyle.right = M; break; // Top-Right
      case 3: newStyle.top = '50%'; newStyle.right = M; newStyle.transform = 'translateY(-50%)'; break; // Right-Middle
      case 4: newStyle.bottom = M; newStyle.right = M; break; // Bottom-Right
      case 5: newStyle.bottom = M; newStyle.left = '50%'; newStyle.transform = 'translateX(-50%)'; break; // Bottom-Center
      case 6: newStyle.bottom = M; newStyle.left = M; break; // Bottom-Left
      case 7: newStyle.top = '50%'; newStyle.left = M; newStyle.transform = 'translateY(-50%)'; break; // Left-Middle
      default: newStyle.top = M; newStyle.left = M;
    }

    setNoStyle(newStyle);
    setNoCount(prev => prev + 1);
    setYesSizeMultiplier(prev => Math.min(prev + 0.1, 2.5)); 
  };

  const handleYesClick = () => {
    setStage('forgiven');
  };

  const handlePhotoUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    setIsSending(true);

    const formData = new FormData();
    formData.append("access_key", ACCESS_KEY);
    formData.append("subject", "She Forgave You! üíñ New Photo");
    formData.append("message", "She clicked 'Yes' and sent a photo!");
    formData.append("attachment", file);

    try {
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData
      });

      const result = await response.json();
      
      if (result.success) {
        setPhotoSent(true);
      } else {
        alert("Photo upload failed, but I still love you! (Maybe the file was too big?)");
      }
    } catch (error) {
      console.error("Error uploading:", error);
      alert("Network error, but the thought counts! ‚ù§Ô∏è");
    } finally {
      setIsSending(false);
    }
  };

  const Confetti = () => {
    return (
      <div className="fixed inset-0 pointer-events-none overflow-hidden z-50">
        {[...Array(50)].map((_, i) => (
          <div
            key={i}
            className="absolute animate-fall"
            style={{
              left: `${Math.random() * 100}%`,
              top: `-20px`,
              animationDuration: `${Math.random() * 3 + 2}s`,
              animationDelay: `${Math.random() * 2}s`,
              backgroundColor: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'][Math.floor(Math.random() * 5)],
              width: '10px',
              height: '10px',
              borderRadius: '50%',
            }}
          />
        ))}
      </div>
    );
  };

  return (
    <div className="min-h-[100dvh] w-full bg-pink-50 flex flex-col items-center justify-center p-4 font-sans text-center overflow-hidden relative">
      <style>{`
        @keyframes fall {
          0% { transform: translateY(0) rotate(0deg); opacity: 1; }
          100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
          100% { transform: translateY(0px); }
        }
        @keyframes pulse-slow {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.8; transform: scale(1.05); }
        }
        .animate-float {
          animation: float 3s ease-in-out infinite;
        }
        .animate-pulse-slow {
          animation: pulse-slow 2s infinite;
        }
      `}</style>

      {/* --- STAGE 1: LANDING SCREEN --- */}
      {stage === 'landing' && (
        <div className="max-w-[90%] w-full flex flex-col items-center gap-6 z-10 animate-fade-in bg-white p-6 md:p-8 rounded-3xl shadow-xl border-4 border-pink-200">
           <div className="bg-gray-100 p-4 rounded-full mb-2">
              <Smartphone size={40} className="text-gray-600" />
           </div>
           
           <h2 className="text-lg md:text-xl font-bold text-gray-700 leading-relaxed">
             You have to tap this to access in IPhone üò©ü•∫
           </h2>

           <button
             onClick={() => setStage('asking')}
             className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2 animate-pulse-slow"
           >
             <Lock size={20} />
             Unlock Access
           </button>
           
           <p className="text-xs text-gray-400 mt-2">Security verification required for cute gf</p>
        </div>
      )}

      {/* --- STAGE 2: ASKING FOR FORGIVENESS --- */}
      {stage === 'asking' && (
        <div className="w-full h-full flex flex-col md:flex-row items-center justify-center gap-6 md:gap-12 z-10">
          
          <div className="w-full md:w-auto flex justify-center animate-float shrink-0">
            <img 
              src="https://media.tenor.com/K2sE88yAHhQAAAAi/bubu-dudu-sseeyall.gif" 
              alt="Sad Bear" 
              className="w-40 h-40 md:w-56 md:h-56 object-contain mix-blend-multiply"
            />
          </div>

          <div className="w-full flex flex-col items-center md:items-start gap-6 px-4">
            <h1 className="text-xl md:text-3xl font-bold text-pink-600 leading-tight text-center md:text-left max-w-lg">
              I'm sorry baccha I know muje nhi sona chiye tha ü•π plzzz mafff kar doooo
            </h1>

            <div className="flex flex-col md:flex-row items-center gap-4 w-full md:justify-start relative min-h-[100px]">
              
              <button
                onClick={handleYesClick}
                style={{ 
                    fontSize: `${1 * yesSizeMultiplier}rem`,
                    padding: `${0.75 * yesSizeMultiplier}rem ${1.5 * yesSizeMultiplier}rem`
                }}
                className="bg-green-500 hover:bg-green-600 text-white font-bold rounded-2xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2 z-20 max-w-[90vw] break-words whitespace-normal leading-tight"
              >
                {noCount >= TAP_LIMIT ? "Isse jada code nhi kar sakta ab kardo üò§ maaf" : "Okey kar diya üòô"}
              </button>

              {noCount < TAP_LIMIT && (
                <button
                  onMouseEnter={moveButton} 
                  onClick={moveButton}      
                  onTouchStart={moveButton} 
                  style={noStyle}
                  className="bg-red-400 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-full shadow-lg whitespace-nowrap transition-all duration-200 text-sm md:text-base z-50"
                >
                   {phrases[Math.min(noCount, phrases.length - 1)]}
                </button>
              )}
            </div>
          </div>
        </div>
      )}

      {/* --- STAGE 3: SUCCESS & CAMERA --- */}
      {stage === 'forgiven' && (
        <div className="max-w-[90%] w-full flex flex-col items-center gap-6 z-10 animate-fade-in pb-10">
          <Confetti />
          
          <div className="animate-float">
            <img 
              src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" 
              alt="Happy Bear" 
              className="w-48 h-48 md:w-56 md:h-56 object-contain mix-blend-multiply"
            />
          </div>

          <div className="space-y-2">
            <h1 className="text-3xl md:text-4xl font-bold text-pink-600 flex items-center justify-center gap-2 text-center">
              YEEEYYYY! <Stars className="text-yellow-400" />
            </h1>
            <p className="text-lg text-gray-700">Chalo ab smile kardo! ‚ù§Ô∏è</p>
          </div>

          {/* --- CAMERA BUTTON SECTION --- */}
          <div className="w-full mt-6 flex justify-center">
            {!photoSent ? (
              <label className={`
                relative w-full max-w-sm bg-gradient-to-r from-blue-500 to-purple-500 
                hover:from-blue-600 hover:to-purple-600 text-white 
                rounded-2xl shadow-xl p-4 cursor-pointer transition-all transform hover:scale-105
                flex flex-col items-center gap-3 border-4 border-white
                ${isSending ? 'opacity-70 pointer-events-none' : ''}
              `}>
                {isSending ? (
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                ) : (
                  <Camera size={32} className="text-white animate-bounce" />
                )}
                
                <span className="text-sm md:text-base font-bold leading-tight px-2">
                  {isSending 
                    ? "Sending your cute photo..." 
                    : "Okey ab chalo 1 pyari si photo click karke bej do üòÅ plzzzz kesi bhi chale giiii plzzz plzzz plzzzz plzz"
                  }
                </span>

                {/* Hidden File Input */}
                <input 
                  type="file" 
                  accept="image/*" 
                  capture="user" // Tries to open front camera on mobile
                  className="hidden" 
                  onChange={handlePhotoUpload}
                  disabled={isSending}
                />
              </label>
            ) : (
              <div className="bg-green-100 text-green-700 border-2 border-green-400 rounded-2xl p-6 flex flex-col items-center gap-2 animate-pulse-slow">
                <Check size={40} className="bg-green-500 text-white rounded-full p-1" />
                <h3 className="font-bold text-xl">Photo Sent!</h3>
                <p>You are the best! Thank you! üíñ</p>
              </div>
            )}
          </div>
          
          <button 
            onClick={() => {
                setStage('landing');
                setYesSizeMultiplier(1);
                setNoCount(0);
                setNoStyle({});
                setPhotoSent(false);
                setIsSending(false);
            }}
            className="mt-8 text-pink-400 hover:text-pink-600 underline text-sm"
          >
            Reset
          </button>
        </div>
      )}
    </div>
  );
}


          
